<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <title>Livraria Online</title>
        <link rel="stylesheet" href="css/style-principal.css">
        <link rel="stylesheet" href="css/style-detalhe.css">
        <link rel="stylesheet" href="css/style-categorias.css">
        <link rel="stylesheet" href="css/style-carrinho.css">
    </head>
    <body>
        <header>
            <div class="logo"><img src="../imagens/livraria-img.png" height="40px" width="40px">  Livraria Online</div>
            <nav class="navBar">
                <a href="paginaPrincipal.html">Home</a>
            </nav>
        </header>

        <main>
            <section id="carrinho-lista" class="carrinho-lista">

            </section>
            <section id="total-carrinho" class="resumo-carrinho">
            </section>
        </main>

        <footer>
            <p>&copy; 2025 Livraria Online - Todos os direitos reservados</p>
        </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            exibirCarrinho();

            $("#btn-finalizar").click(function() {
                finalizarCompra();
            });
        });

    function exibirCarrinho() {
        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
        let container = $("#carrinho-lista");
        let totalCarrinho = $("#total-carrinho");
        let conteudo = ``;
        container.empty();

        console.log(carrinho.length)
        if (carrinho.length === 0) {
            container.html(`<div class="resumo-carrinho"><label class="label">Seu carrinho está vazio</label></div`);
            $("#total-carrinho").text("Total: R$ 0,00");
            return;
        } 

        conteudo = `
            <div class="item-carrinho">
                <table class="lista-categorias">
                    <tr>
                        <th>Livro</th>   
                        <th>Preço</th>   
                        <th>Quantidade</th>   
                        <th>Subtotal</th>   
                        <th></th>   
                    </tr>
        `;
        carrinho.forEach((item, index) => {
            conteudo +=`
                <tr>
                    <td><strong>${item.titulo}</strong><br></td>   
                    <td>R$ ${parseFloat(item.preco).toFixed(2)}</td>   
                    <td>
                        <button class="button-actions" onclick="alterarQuantidade(${index}, -1)">-</button>
                        <span>${item.quantidade}</span>
                        <button class="button-actions" onclick="alterarQuantidade(${index}, 1)">+</button>
                    </td>   
                    <td>R$ ${parseFloat(item.preco).toFixed(2)*item.quantidade}</td>   
                    <td>
                        <button 
                            style="padding: 5px;margin: 5px;background-color: #939edf;border:none;border-radius: 10px;color: white;cursor:pointer;"
                            onclick="removerItem(${index})">Remover</button>    
                    </td>   
                </tr>`;
        });
        
        conteudo += `</table></div>`;
        container.append(conteudo);

        let total = carrinho.reduce((soma, item) => soma + item.preco * item.quantidade, 0);

        let resumo = `
            <div class="item-resumo" >
                <label class="label">Cliente:</label>
                <select id="clientes" class="select-categorias">
                    
                </select>    
            </div>
            <div class="item-resumo">
                <p>Total: R$ ${total.toFixed(2)}</p>
                <button class="button-comprar">Finalizar Compra</button>
            </div>
            `;

        totalCarrinho.append(resumo);
        // carregarClientes();
    }

    // function carregarClientes() {
    //     $.ajax({
    //         url: "http://localhost:8080/clientes",
    //         method: "GET"
    //     }).done(
    //         function (clientes) {
    //             clientes.forEach(function (cliente) {

    //                 $("#clientes").append(
    //                     `<option value="${cliente.id}">${cliente.nome}</option>`
    //                 )
    //             })
    //         }
    //     )
    // }

    function alterarQuantidade(index, delta) {
        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
        carrinho[index].quantidade += delta;

        if (carrinho[index].quantidade <= 0) {
            carrinho.splice(index, 1);
        }

        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        exibirCarrinho();
    }

    function removerItem(index) {
        let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
        carrinho.splice(index, 1);
        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        exibirCarrinho();
    }

    // function finalizarCompra() {
    //     let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

    //     if (carrinho.length === 0) {
    //         alert("Seu carrinho está vazio!");
    //         return;
    //     }

    //     $.ajax({
    //         url: "http://localhost:8080/pedidos",
    //         method: "POST",
    //         contentType: "application/json",
    //         data: JSON.stringify({ itens: carrinho })
    //     }).done(function() {
    //         alert("Pedido finalizado com sucesso!");
    //         localStorage.removeItem("carrinho");
    //         window.location.href = "paginaPrincipal.html";
    //     }).fail(function() {
    //         alert("Erro ao finalizar pedido.");
    //     });
    // }

    </script>
</body>
</html>